{% comment %}
  This snippet is used to display the free delivery progress bar.
  It is used in the cart drawer.
{% endcomment %}

{% comment %}
  In Shopify, cart.total_price is in minor currency units (tiyins for sum)
  10,000 sum = 1,000,000 tiyins
{% endcomment %}
{% assign free_delivery_threshold = 10000 %}
{% assign current_total = cart.total_price %}
{% assign progress_percentage = current_total | times: 100 | divided_by: free_delivery_threshold %}
{% assign remaining_amount = free_delivery_threshold | minus: current_total %}

{% if progress_percentage > 100 %}
  {% assign progress_percentage = 100 %}
{% endif %}

{% comment %} Debug info - remove this later {% endcomment %}
{% comment %} <div style="font-size: 12px; color: #666; margin-bottom: 8px; text-align: center;">
  Debug: Cart total: {{ current_total }} | Threshold: {{ free_delivery_threshold }} | Progress: {{ progress_percentage }}%
</div> {% endcomment %}

<div class="free-delivery-progress">
  {% if current_total >= free_delivery_threshold %}
    <div class="free-delivery-message free-delivery-message--achieved">
      <span class="free-delivery-icon">ðŸšš</span>
      <span class="free-delivery-text">Free delivery</span>
    </div>
  {% else %}
    <div class="free-delivery-message">
      <span class="free-delivery-text">
        Add {{ remaining_amount | money }} more for free delivery
      </span>
    </div>
  {% endif %}
  
  <div class="free-delivery-progress-bar">
    <div class="free-delivery-progress-bar-fill" data-progress="{{ progress_percentage }}">
      <div class="free-delivery-progress-bar-shine"></div>
    </div>
  </div>
</div>

<style>
.free-delivery-progress {
  margin-bottom: 16px;
}

.free-delivery-message {
  text-align: center;
  margin-bottom: 12px;
  padding: 8px 12px;
  border-radius: 6px;
  background: rgba(33, 37, 41, 0.03);
  transition: all 0.3s ease;
}

.free-delivery-message--achieved {
  background: rgba(34, 197, 94, 0.1);
  color: #16a34a;
}

.free-delivery-text {
  font-size: 14px;
  font-weight: 500;
  color: #525252;
}

.free-delivery-message--achieved .free-delivery-text {
  color: #16a34a;
}

.free-delivery-icon {
  margin-right: 6px;
  font-size: 16px;
}

.free-delivery-progress-bar {
  width: 100%;
  height: 8px;
  background: #e7e7e7;
  border-radius: 4px;
  overflow: hidden;
  position: relative;
}

.free-delivery-progress-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, #3b82f6, #1d4ed8);
  border-radius: 4px;
  width: 0%;
  transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.free-delivery-progress-bar-fill[data-progress="100"] {
  background: linear-gradient(90deg, #22c55e, #16a34a);
}

.free-delivery-progress-bar-shine {
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.3),
    transparent
  );
  animation: shine 2s infinite;
}

@keyframes shine {
  0% {
    left: -100%;
  }
  50% {
    left: 100%;
  }
  100% {
    left: 100%;
  }
}

/* Pulse animation when achieved */
.free-delivery-message--achieved {
  animation: pulse-success 0.6s ease-out;
}

@keyframes pulse-success {
  0% {
    transform: scale(1);
    background: rgba(34, 197, 94, 0.1);
  }
  50% {
    transform: scale(1.02);
    background: rgba(34, 197, 94, 0.2);
  }
  100% {
    transform: scale(1);
    background: rgba(34, 197, 94, 0.1);
  }
}
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    updateFreeDeliveryProgress();
  });

  function updateFreeDeliveryProgress() {
    const progressBar = document.querySelector('.free-delivery-progress-bar-fill');
    if (progressBar) {
      const progress = progressBar.getAttribute('data-progress');
      // Small delay to ensure smooth animation
      setTimeout(() => {
        progressBar.style.width = progress + '%';
      }, 100);
    }
  }

  // Export function for use in cart drawer updates
  window.updateFreeDeliveryProgress = updateFreeDeliveryProgress;
</script>


